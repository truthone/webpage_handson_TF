<html>
  <head>
    <title>AMAZING MARKET</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Do+Hyeon&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./global.css" />
    <link rel="stylesheet" href="./index.css" />
  </head>

  <body>
    <header class="sticky">
      <div id="logo">💖어메이징마켓💖</div>
      <nav id="menu">
        <button class="icon icon-nav material-symbols-rounded" id="cart-button">
          shopping_cart_checkout
        </button>
        <button class="icon icon-nav material-symbols-rounded">person</button>
      </nav>
    </header>
    <main>
      <article>
        <img
          src="https://media.graphassets.com/1VNPaRMKQH6XD3hQT9Fd"
          alt="메인 배너"
        />
      </article>
    </main>
    <footer>AMAZING MARKET ⓒ 2024</footer>
    <script src="./header.js"></script>
    <script type="module" src="./render.js"></script>
    <script type="module">
      import { promotions } from 'https://media.graphassets.com/n5qrl3pRBWb51NXtbdr8';
      document.addEventListener('DOMContentLoaded', function () {
        const container = document.querySelector('main');
        container.addEventListener('click', (e) => {
          if (e.target.matches('.add-cart-button')) {
            const itemId = e.target.parentElement.dataset.id;
            if (itemId) {
              addToCart(itemId);
            }
          }
        });
      });

      let cart = JSON.parse(localStorage.getItem('cart')) || [];

      const productList = [];

      promotions.forEach((p) => {
        p.products.forEach((p) => {
          productList.push(p);
        });
      });

      function addToCart(productId) {
        const product = productList.find((p) => p.productId === productId);
        if (product) {
          const isProductInCart = cart.some((p) => p.productId === productId);
          if (!isProductInCart) {
            cart.push({ ...product, quantity: 1 });
          } else {
            const productInCart = cart.find((p) => p.productId === productId);
            productInCart.quantity += 1;
          }
          saveCart();
        }
      }

      function saveCart() {
        localStorage.setItem('cart', JSON.stringify(cart));
        alert('장바구니에 추가되었습니다!');
      }
    </script>
  </body>
</html>
